(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{477:function(e,t,s){"use strict";s.r(t);var a=s(69),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"custom-rate-limit-settings"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#custom-rate-limit-settings"}},[e._v("#")]),e._v(" Custom rate limit settings")]),e._v(" "),s("p",[e._v("This section introduces the rate limit of the API in GROWI.")]),e._v(" "),s("h2",{attrs:{id:"summary"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#summary"}},[e._v("#")]),e._v(" Summary")]),e._v(" "),s("p",[e._v("The maximum number of requests that are allowed per rate limit window (second) can be set per endpoint and per user (IP for guest users).\nThe rate limit window is 60 seconds and has a fixed value.\nIf more than the maximum number of requests that are allowed are received by the same user within the rate-limit window, an error "),s("code",[e._v("419 too many requests")]),e._v(" is returned.")]),e._v(" "),s("h3",{attrs:{id:"for-logged-in-users"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#for-logged-in-users"}},[e._v("#")]),e._v(" For logged-in users")]),e._v(" "),s("p",[e._v("For logged-in users, the key to identifying the user is a hash value of a string containing the "),s("strong",[e._v("endpoint")]),e._v(", "),s("strong",[e._v("request method")]),e._v(", and "),s("strong",[e._v("user ID")]),e._v(".\nRequests from the same IP address can also be distinguished for each user.")]),e._v(" "),s("h3",{attrs:{id:"for-non-logged-in-users"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#for-non-logged-in-users"}},[e._v("#")]),e._v(" For non-logged-in users")]),e._v(" "),s("p",[e._v("For non-logged-in users, the key to identifying the user is a hash value of a string containing the "),s("strong",[e._v("endpoint")]),e._v(", "),s("strong",[e._v("request method")]),e._v(", and "),s("strong",[e._v("IP address")]),e._v(".\nAt this time, the maximum number of requests that are allowed is multiplied by the expected number of people per IP address.\nThe default number of people assumed per IP address is 5 people/IP.\nThe number of people assumed per IP address can be customized for each endpoint and method using environment variables.")]),e._v(" "),s("h2",{attrs:{id:"default-settings"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#default-settings"}},[e._v("#")]),e._v(" Default Settings")]),e._v(" "),s("p",[e._v("Endpoints are restricted by default in the table below.")]),e._v(" "),s("table",[s("thead",[s("tr",[s("th",[e._v("window(sec)")]),e._v(" "),s("th",[e._v("max requests(times)")]),e._v(" "),s("th",[e._v("Assumed number of people per IP address")])])]),e._v(" "),s("tbody",[s("tr",[s("td",[e._v("60")]),e._v(" "),s("td",[e._v("500")]),e._v(" "),s("td",[e._v("5")])])])]),e._v(" "),s("h3",{attrs:{id:"endpoints-with-customized-initial-values"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#endpoints-with-customized-initial-values"}},[e._v("#")]),e._v(" Endpoints with customized initial values")]),e._v(" "),s("p",[e._v("Other endpoints that require restrictions have default customized initial values set as restrictions by the following configuration file.")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/growilabs/growi/blob/master/packages/app/config/rate-limiter.ts",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/growilabs/growi/blob/master/packages/app/config/rate-limiter.ts"),s("OutboundLink")],1)]),e._v(" "),s("h2",{attrs:{id:"limit-customization"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#limit-customization"}},[e._v("#")]),e._v(" Limit Customization")]),e._v(" "),s("p",[e._v("To override the default restrictions and customize the system, use environment variables to set them.")]),e._v(" "),s("h3",{attrs:{id:"setting-example"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#setting-example"}},[e._v("#")]),e._v(" Setting Example")]),e._v(" "),s("p",[e._v("The following four items are set by environment variables.")]),e._v(" "),s("ul",[s("li",[e._v("Endpoint (required)")]),e._v(" "),s("li",[e._v("request methods")]),e._v(" "),s("li",[e._v("Maximum number of requests per rate-limit window (required)")]),e._v(" "),s("li",[e._v("Assumed number of people per IP address")])]),e._v(" "),s("p",[e._v("You can set environment variables as shown below.")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("API_RATE_LIMIT_"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("KEY"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("_ENDPOINT"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("/_api/v3/foo // Endpoint\nAPI_RATE_LIMIT_"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("KEY"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("_METHODS"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("GET,POST // request methods\nAPI_RATE_LIMIT_"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("KEY"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("_MAX_REQUESTS"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),e._v(" // Maximum number of requests per rate-limit window\nAPI_RATE_LIMIT_"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("KEY"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("_USERS_PER_IP"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v(" // Assumed number of people per IP address\n")])])]),s("p",[e._v("Settings other than the request method are optional.\nIf not set, restrictions are placed on all methods for that endpoint.\nThe number of people assumed per IP address is set to the default value of 5 if not set.")]),e._v(" "),s("p",[e._v("The "),s("code",[e._v("[key]")]),e._v(" part is an arbitrary string.\nHowever, if a limit is set for the same endpoint, the setting for the key that comes later will take precedence\nwhen the "),s("code",[e._v("[key]")]),e._v(" part is sorted by the in-place algorithm (JavaScript's sort() method).")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("API_RATE_LIMIT_010_FOO_ENDPOINT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("/_api/v3/foo\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("API_RATE_LIMIT_010_FOO_METHODS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("GET,POST\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("API_RATE_LIMIT_010_FOO_MAX_REQUESTS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("API_RATE_LIMIT_010_FOO_USERS_PER_IP")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("\n")])])]),s("p",[e._v("When environment variables are set in this manner, the following restrictions apply")]),e._v(" "),s("ul",[s("li",[e._v("For logged-in users")])]),e._v(" "),s("p",[e._v("If you send more than 11 "),s("code",[e._v("GET")]),e._v(" or "),s("code",[e._v("POST")]),e._v(" requests in 60 seconds to the endpoint "),s("code",[e._v("/_api/v3/foo")]),e._v(",\nan error will occur and you will not be able to send requests after the 11th request.\nAfter 60 seconds have elapsed, the request can be sent again.")]),e._v(" "),s("ul",[s("li",[e._v("For non-logged-in users")])]),e._v(" "),s("p",[e._v("If you send more than 21 "),s("code",[e._v("GET")]),e._v(" or "),s("code",[e._v("POST")]),e._v(" requests from the same IP address to the endpoint "),s("code",[e._v("/_api/v3/foo")]),e._v(",\nan error will occur and you will not be able to send requests after the 21st request.\nAfter 60 seconds have elapsed, the request can be sent again.")]),e._v(" "),s("h3",{attrs:{id:"customize-environment-variables-using-regular-expressions"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#customize-environment-variables-using-regular-expressions"}},[e._v("#")]),e._v(" Customize environment variables using regular expressions")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("GET "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'/62df87c8539c3090b8cc7621'")]),e._v(" // get page\nGET "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'/share/62e2256f19e932f82eebe830'")]),e._v(" // get share page\n")])])]),s("p",[e._v("Variable endpoint restrictions, such as those above, can be customized using regular expressions and environment variables.")]),e._v(" "),s("h3",{attrs:{id:"setting-example-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#setting-example-2"}},[e._v("#")]),e._v(" Setting Example")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("API_RATE_LIMIT_010_SHARE_ENDPOINT_WITH_REGEXP")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("/share/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("-9a-z"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("24")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("API_RATE_LIMIT_010_SHARE_METHODS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("GET\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("API_RATE_LIMIT_010_SHARE_MAX_REQUESTS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("20")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("API_RATE_LIMIT_010_SHARE_USERS_PER_IP")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);