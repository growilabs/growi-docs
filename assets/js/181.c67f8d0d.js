(window.webpackJsonp=window.webpackJsonp||[]).push([[181],{629:function(s,a,t){"use strict";t.r(a);var e=t(69),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"ubuntu-server"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu-server"}},[s._v("#")]),s._v(" Ubuntu Server")]),s._v(" "),t("p"),t("div",{staticClass:"table-of-contents"},[t("ul",[t("li",[t("a",{attrs:{href:"#概要"}},[s._v("概要")])]),t("li",[t("a",{attrs:{href:"#ツール類のインストール"}},[s._v("ツール類のインストール")])]),t("li",[t("a",{attrs:{href:"#node-js-20-x-npm-のインストール"}},[s._v("node.js 20.x & npm のインストール")])]),t("li",[t("a",{attrs:{href:"#elasticsearch"}},[s._v("Elasticsearch")])]),t("li",[t("a",{attrs:{href:"#mongodb"}},[s._v("MongoDB")])]),t("li",[t("a",{attrs:{href:"#growi"}},[s._v("GROWI")])]),t("li",[t("a",{attrs:{href:"#リバースプロキシの設定"}},[s._v("リバースプロキシの設定")])])])]),t("p"),s._v(" "),t("h2",{attrs:{id:"概要"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#概要"}},[s._v("#")]),s._v(" 概要")]),s._v(" "),t("p",[s._v("この章では Ubuntu Server 22.04 (Jammy) に GROWI をインストールする方法を紹介します。 他のバージョンは現在未検証です。")]),s._v(" "),t("p",[s._v("セットアップに必要となるソフトウェアは以下の通りです。")]),s._v(" "),t("ul",[t("li",[s._v("node.js 18.x or 20.x")]),s._v(" "),t("li",[s._v("npm 6.x")]),s._v(" "),t("li",[s._v("pnpm")]),s._v(" "),t("li",[s._v("MongoDB 4.4 以上 (6.0 以上を推奨)")]),s._v(" "),t("li",[s._v("(Option) Elasticsearch 7.x or 8.x")]),s._v(" "),t("li",[s._v("(Option) systemd")]),s._v(" "),t("li",[s._v("(Option) Apache or nginx")])]),s._v(" "),t("p",[s._v("Optional となっているものは必須ではありません。ただし、本項ではこれら全てを利用し、全文検索できる GROWI を Apache or nginx でリバースプロキシする環境を構築し、systemd でホストと同時に起動させる方法を説明します。\n")]),s._v(" "),t("h2",{attrs:{id:"ツール類のインストール"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ツール類のインストール"}},[s._v("#")]),s._v(" ツール類のインストール")]),s._v(" "),t("p",[s._v("インストールの過程で必要になる "),t("code",[s._v("git")]),s._v(", "),t("code",[s._v("curl")]),s._v(" をインストールします。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v("\n")])])]),t("h2",{attrs:{id:"node-js-20-x-npm-のインストール"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#node-js-20-x-npm-のインストール"}},[s._v("#")]),s._v(" node.js 20.x & npm のインストール")]),s._v(" "),t("h3",{attrs:{id:"nodesource-repository-を利用する"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nodesource-repository-を利用する"}},[s._v("#")]),s._v(" NodeSource repository を利用する")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://deb.nodesource.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://deb.nodesource.com/"),t("OutboundLink")],1),s._v(" から Node.js のインストールスクリプトを取得します。作業ディレクトリはホームディレクトリで作業します。\n")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-sL")]),s._v(" https://deb.nodesource.com/setup_20.x "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" nodesource_setup.sh\n")])])]),t("p",[s._v("取得したスクリプトを実行します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" nodesource_setup.sh\n")])])]),t("p",[s._v("これにより "),t("code",[s._v("apt")]),s._v(" 経由で node.js が取得できるようになったので、 "),t("code",[s._v("apt")]),s._v(" コマンドでインストールを行います。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nodejs\n")])])]),t("p",[s._v("GROWI では pnpm を用いたパッケージインストールを利用するため、ここで "),t("code",[s._v("pnpm")]),s._v(" コマンドをインストールしておきます。")]),s._v(" "),t("p",[t("code",[s._v("<version>")]),s._v(" 部分は公式サイトの情報を確認し、適宜選択してください。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-fsSL")]),s._v(" https://get.pnpm.io/install.sh "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("env")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PNPM_VERSION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("version"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" -\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" setup\n")])])]),t("p",[s._v("また、GROWI では Turborepo を用いてビルドを行うため、"),t("code",[s._v("turbo")]),s._v(" コマンドをインストールします。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" turbo "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--global")]),s._v("\n")])])]),t("p",[s._v("Node.js, npm, pnpm, turbo のインストールが完了したら、インストールしたバージョンを確認しましょう。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ nodejs "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v("\nv20.12.2\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.5")]),s._v(".0\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.12")]),s._v(".2\n$ turbo "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.1")]),s._v(".3\n")])])]),t("h2",{attrs:{id:"elasticsearch"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch"}},[s._v("#")]),s._v(" Elasticsearch")]),s._v(" "),t("h3",{attrs:{id:"インストール"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#インストール"}},[s._v("#")]),s._v(" インストール")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/deb.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("公式ページ"),t("OutboundLink")],1),s._v(" に従い、インストールを進めます。 ここでは Elasticsearch 8.x をインストールします。")]),s._v(" "),t("p",[s._v("まず、Elasticsearch を実行できるように JDK17 をインストールします。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" openjdk-17-jdk\n")])])]),t("p",[s._v("パッケージをインストールするために、Elasticsearch レポジトリの GPG キーを追加します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-qO")]),s._v(" - https://artifacts.elastic.co/GPG-KEY-elasticsearch "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" gpg "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dearmor")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" /usr/share/keyrings/elasticsearch-keyring.gpg\n")])])]),t("p",[s._v("Elasticsearch のレポジトリを追加します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"deb [signed-by=/usr/share/keyrings/elasticsearch-keyring.gpg] https://artifacts.elastic.co/packages/8.x/apt stable main"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/apt/sources.list.d/elastic-8.x.list\n")])])]),t("p",[s._v("これで、apt 経由で Elasticsearch がインストールできるようになったため、インストールを行います。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" elasticsearch\n")])])]),t("p",[s._v("インストールが完了すると、elasticユーザーのデフォルトパスワードが表示されるので、念のためどこかにメモしておきましょう。")]),s._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("--------------------------- Security autoconfiguration information ------------------------------ \nAuthentication and authorization are enabled. \nTLS for the transport and HTTP layers is enabled and configured. \nThe generated password for the elastic built-in superuser is : ～～～～～～～\n")])])]),t("p",[s._v("ここで Elasticsearch に割り当てるメモリを調整します。メモリの割り当ては個人ユースであれば 256MB で十分です。チーム規模、ページの量に応じて変更してください。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/elasticsearch/jvm.options\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# IMPORTANT: JVM heap size のコメントブロックの後に追記")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Xms256m")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Xmx256m")]),s._v("\n")])])]),t("p",[s._v("インストールが完了したら、 パッケージのバージョンを確認します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ dpkg "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" elasticsearch\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Desired")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Unknown/Install/Remove/Purge/Hold\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Status")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("/ Err?"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("/Reinst-required "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Status,Err: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("uppercase")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bad"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("/ Name           Version      Architecture Description\n+++-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\nii  elasticsearch  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.13")]),s._v(".2       amd64        Distributed RESTful search engine built "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the cloud\n")])])]),t("h3",{attrs:{id:"tls-の無効化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tls-の無効化"}},[s._v("#")]),s._v(" TLS の無効化")]),s._v(" "),t("p",[s._v("Elasticsearch 8.x では、デフォルトでは TLS 通信のみ受け付ける設定です。GROWI からは、HTTP で通信するため、設定を変更する必要があります。")]),s._v(" "),t("p",[t("code",[s._v("/etc/elasticsearch/elasticsearch.yml")]),s._v(" を編集し、以下の差分を参考に3箇所の設定を true から false に変更します。")]),s._v(" "),t("div",{staticClass:"language-diff extra-class"},[t("pre",{pre:!0,attrs:{class:"language-diff"}},[t("code",[s._v("diff -uNr old/elasticsearch.yml new/elasticsearch.yml\n"),t("span",{pre:!0,attrs:{class:"token coord"}},[s._v("--- old/elasticsearch.yml       2024-04-30 13:36:37.106652641 +0000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token coord"}},[s._v("+++ new/elasticsearch.yml       2024-04-30 13:38:07.739773922 +0000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token coord"}},[s._v("@@ -89,18 +89,18 @@")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("# --------------------------------------------------------------------------------\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("# Enable security features\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("xpack.security.enabled: true\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("xpack.security.enabled: false\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("xpack.security.enrollment.enabled: true\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("# Enable encryption for HTTP API client connections, such as Kibana, Logstash, and Agents\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("xpack.security.http.ssl:\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  enabled: true\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  enabled: false\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  keystore.path: certs/http.p12\n")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("# Enable encryption and mutual authentication between cluster nodes\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("xpack.security.transport.ssl:\n")])]),t("span",{pre:!0,attrs:{class:"token deleted-sign deleted"}},[t("span",{pre:!0,attrs:{class:"token prefix deleted"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  enabled: true\n")])]),t("span",{pre:!0,attrs:{class:"token inserted-sign inserted"}},[t("span",{pre:!0,attrs:{class:"token prefix inserted"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  enabled: false\n")])]),t("span",{pre:!0,attrs:{class:"token unchanged"}},[t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  verification_mode: certificate\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  keystore.path: certs/transport.p12\n")]),t("span",{pre:!0,attrs:{class:"token prefix unchanged"}},[s._v(" ")]),t("span",{pre:!0,attrs:{class:"token line"}},[s._v("  truststore.path: certs/transport.p12\n")])])])])]),t("h3",{attrs:{id:"growi-に必要な-elasticsearch-プラグインのインストール"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#growi-に必要な-elasticsearch-プラグインのインストール"}},[s._v("#")]),s._v(" GROWI に必要な Elasticsearch プラグインのインストール")]),s._v(" "),t("p",[s._v("以下の Elasticsearch plugin をインストールします。")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/plugins/current/analysis-kuromoji.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Japanese (kuromoji) Analysis plugin"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://www.elastic.co/guide/en/elasticsearch/plugins/current/analysis-icu.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("ICU Analysis Plugin"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("まずは、Elasticsearch plugin をインストールするために利用するコマンドを検索します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ dpkg "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" elasticsearch "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" bin "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" plugin\n/usr/share/elasticsearch/bin/elasticsearch-plugin\n")])])]),t("p",[s._v("上記で出力されたコマンドを利用して、 analysis-kuromoji plugin と analysis-icu plugin をインストールします。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# analysis-kuromoji のインストール")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" /usr/share/elasticsearch/bin/elasticsearch-plugin "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" analysis-kuromoji\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# analysis-icu plugin のインストール")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" /usr/share/elasticsearch/bin/elasticsearch-plugin "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" analysis-icu\n")])])]),t("h3",{attrs:{id:"elasticsearch-の起動と自動起動設定の有効化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch-の起動と自動起動設定の有効化"}},[s._v("#")]),s._v(" Elasticsearch の起動と自動起動設定の有効化")]),s._v(" "),t("p",[t("code",[s._v("systemctl")]),s._v(" コマンドを使って、Elasticsearch の自動起動設定を有効化し、起動します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--now")]),s._v(" elasticsearch\n")])])]),t("p",[s._v("正常に起動しているか確認します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ systemctl status elasticsearch\n● elasticsearch.service - Elasticsearch\n     Loaded: loaded "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/lib/systemd/system/elasticsearch.service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" enabled"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" vendor preset: enabled"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n     Active: active "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("running"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" since Fri "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2024")]),s._v("-05-03 08:46:23 JST"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 11min ago\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])])]),t("p",[s._v("また、http で通信できることを確認します。")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("$ curl http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//localhost:9200/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost.localdomain"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"cluster_name"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"elasticsearch"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"cluster_uuid"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_na_"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"version"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"number"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8.13.3"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build_flavor"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build_type"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rpm"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build_hash"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"617f7b76c4ebcb5a7f1e70d409a99c437c896aea"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build_date"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2024-04-29T22:05:16.051731935Z"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build_snapshot"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"lucene_version"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"9.10.0"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"minimum_wire_compatibility_version"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"7.17.0"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"minimum_index_compatibility_version"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"7.0.0"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"tagline"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"You Know, for Search"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h2",{attrs:{id:"mongodb"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mongodb"}},[s._v("#")]),s._v(" MongoDB")]),s._v(" "),t("h3",{attrs:{id:"インストール-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#インストール-2"}},[s._v("#")]),s._v(" インストール")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.mongodb.com/docs/v6.0/tutorial/install-mongodb-on-ubuntu/",target:"_blank",rel:"noopener noreferrer"}},[s._v("公式ページ"),t("OutboundLink")],1),s._v(" に従ってインストールを実施します。 バージョンは、MongoDB 6.0 です。")]),s._v(" "),t("p",[s._v("まずは、"),t("code",[s._v("apt")]),s._v(" のために public key をインポートします。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-fsSL")]),s._v(" https://www.mongodb.org/static/pgp/server-6.0.asc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" gpg "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" /usr/share/keyrings/mongodb-server-6.0.gpg "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dearmor")]),s._v("\n")])])]),t("p",[s._v("レポジトリを追加します。ここでは Ubuntu 20.04 と Ubuntu 22.04 の例を記載しています。")]),s._v(" "),t("p",[t("strong",[s._v("Ubuntu 20.04")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"deb [ arch=amd64,arm64 signed-by=/usr/share/keyrings/mongodb-server-6.0.gpg ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/6.0 multiverse"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/apt/sources.list.d/mongodb-org-6.0.list\n")])])]),t("p",[t("strong",[s._v("Ubuntu 22.04")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"deb [ arch=amd64,arm64 signed-by=/usr/share/keyrings/mongodb-server-6.0.gpg ] https://repo.mongodb.org/apt/ubuntu jammy/mongodb-org/6.0 multiverse"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/apt/sources.list.d/mongodb-org-6.0.list\n\n")])])]),t("p",[s._v("レポジトリの追加まで完了したため、MongoDB のインストールを行います。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" mongodb-org\n")])])]),t("p",[s._v("インストールが完了したら、 パッケージのバージョンを確認します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ dpkg-query "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mongodb-org*:amd64"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Desired")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Unknown/Install/Remove/Purge/Hold\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Status")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("/ Err?"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("/Reinst-required "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Status,Err: "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("uppercase")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("bad"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("/ Name                             Version      Architecture Description\n+++-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\nii  mongodb-org                      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.0")]),s._v(".15       amd64        MongoDB "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" document-oriented database system "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("metapackage"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nii  mongodb-org-database             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.0")]),s._v(".15       amd64        MongoDB "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" document-oriented database system "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("metapackage"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nii  mongodb-org-database-tools-extra "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.0")]),s._v(".15       amd64        Extra MongoDB database tools\nii  mongodb-org-mongos               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.0")]),s._v(".15       amd64        MongoDB sharded cluster query router\nii  mongodb-org-server               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.0")]),s._v(".15       amd64        MongoDB database server\nii  mongodb-org-shell                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.0")]),s._v(".15       amd64        MongoDB shell client\nii  mongodb-org-tools                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.0")]),s._v(".15       amd64        MongoDB tools\n")])])]),t("p",[t("code",[s._v("systemctl")]),s._v(" コマンドを使って、MongoDB の自動起動設定を有効化し、起動します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--now")]),s._v(" mongod\n")])])]),t("p",[s._v("正常に起動しているか確認します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ systemctl status mongod\n● mongod.service - MongoDB Database Server\n     Loaded: loaded "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/lib/systemd/system/mongod.service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" enabled"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" vendor preset: enabled"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n     Active: active "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("running"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" since Fri "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2024")]),s._v("-05-03 08:45:35 JST"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 14min ago\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])])]),t("h2",{attrs:{id:"growi"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#growi"}},[s._v("#")]),s._v(" GROWI")]),s._v(" "),t("h3",{attrs:{id:"インストール-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#インストール-3"}},[s._v("#")]),s._v(" インストール")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/growilabs/growi",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/growilabs/growi"),t("OutboundLink")],1),s._v(" からソースコードを取得し、\n"),t("a",{attrs:{href:"https://github.com/growilabs/growi/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/growilabs/growi/releases"),t("OutboundLink")],1),s._v(" にて、最新の安定版のバージョンを確認します。")]),s._v(" "),t("p",[s._v("ここでは "),t("code",[s._v("/opt/growi")]),s._v(" 配下にインストールする手順を記載しています。所有ユーザー・グループを GROWI 実行ユーザーに変更するため、"),t("code",[s._v("<username>")]),s._v(" と "),t("code",[s._v("<usergroup>")]),s._v(" は適宜変更してください。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /opt/\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" chwon "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("username"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("usergroup"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /opt/\n$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/growilabs/growi growi\n$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" growi\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# タグの確認")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" tag "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--sort")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("-version:refname "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-10")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nv7.2.0\nv7.2.1\nv7.2.3\nv7.2.4\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RC がついていない最新版を利用")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" checkout "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-b")]),s._v(" v7.2.4 refs/tags/v7.2.4\n")])])]),t("p",[s._v("ソースコードを clone した後に、"),t("code",[s._v("pnpm")]),s._v(" コマンドを利用して、 GROWI に必要なパッケージをインストールします。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/growi\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])])]),t("h3",{attrs:{id:"ビルド"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ビルド"}},[s._v("#")]),s._v(" ビルド")]),s._v(" "),t("p",[s._v("パッケージのインストールが完了したら、ビルドを行います。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" run app:build\n")])])]),t("p",[s._v("これには、しばらく時間がかかります。")]),s._v(" "),t("h3",{attrs:{id:"起動確認"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#起動確認"}},[s._v("#")]),s._v(" 起動確認")]),s._v(" "),t("p",[s._v("ビルドが完了したら、起動確認を行います。")]),s._v(" "),t("p",[s._v("ここでは MongoDB と Elasticsearch が同一ホストで稼働していることを前提としています。")]),s._v(" "),t("p",[t("code",[s._v("MONGO_URI")]),s._v(" と "),t("code",[s._v("ELASTICSEARCH_URI")]),s._v(" は環境に合わせて適宜書き換えてください。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MONGO_URI")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mongodb://localhost:27017/growi "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ELASTICSEARCH_URI")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://localhost:9200/growi "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run app:server\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以下のメッセージが表示されるまでしばらく待つ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"growi:crowi"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hostname"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"growi-server"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pid"')]),s._v(":29259,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"level"')]),s._v(":30,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[production] Express server is listening on port 3000"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"time"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2024-04-30T21:50:05.549Z"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v"')]),s._v(":0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[t("code",[s._v("http://<hostname or ip address>:3000/")]),s._v(" にアクセスし、初回セットアップ画面が表示されることを確認します。")]),s._v(" "),t("h3",{attrs:{id:"systemd-による自動起動の設定"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#systemd-による自動起動の設定"}},[s._v("#")]),s._v(" systemd による自動起動の設定")]),s._v(" "),t("p",[s._v("「"),t("RouterLink",{attrs:{to:"/ja/admin-guide/admin-cookbook/launch-with-systemd.html"}},[s._v("systemd による自動起動")]),s._v("」を参照してください。")],1),s._v(" "),t("h2",{attrs:{id:"リバースプロキシの設定"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#リバースプロキシの設定"}},[s._v("#")]),s._v(" リバースプロキシの設定")]),s._v(" "),t("p",[s._v("ここでは、起動した GROWI に対してリバースプロキシを行うための設定例を記載します。")]),s._v(" "),t("h3",{attrs:{id:"apache"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#apache"}},[s._v("#")]),s._v(" Apache")]),s._v(" "),t("h4",{attrs:{id:"インストール-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#インストール-4"}},[s._v("#")]),s._v(" インストール")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" apache2\n")])])]),t("h4",{attrs:{id:"必要なモジュールの有効化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#必要なモジュールの有効化"}},[s._v("#")]),s._v(" 必要なモジュールの有効化")]),s._v(" "),t("p",[s._v("proxy, proxy_http, proxy_wstunnel module をインストールします。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" a2enmod proxy proxy_http proxy_wstunnel\n")])])]),t("h4",{attrs:{id:"リバースプロキシの設定例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#リバースプロキシの設定例"}},[s._v("#")]),s._v(" リバースプロキシの設定例")]),s._v(" "),t("p",[s._v("ここではリバースプロキシに関する箇所を抜粋して記載しています。")]),s._v(" "),t("div",{staticClass:"language-apacheconf extra-class"},[t("pre",{pre:!0,attrs:{class:"language-apacheconf"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive-block tag"}},[t("span",{pre:!0,attrs:{class:"token directive-block tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("IfModule")]),t("span",{pre:!0,attrs:{class:"token directive-block-parameter attr-value"}},[s._v(" mod_ssl.c")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token directive-block tag"}},[t("span",{pre:!0,attrs:{class:"token directive-block tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("VirtualHost")]),t("span",{pre:!0,attrs:{class:"token directive-block-parameter attr-value"}},[s._v(" _default_"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("443")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    ...\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# reverse proxy to crowi")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Header に Host: example.com を追加するため")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive-inline property"}},[s._v("ProxyPreserveHost")]),s._v(" On\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HTTPS利用時: Header に x-forwarded-proto: https を追加するため")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive-inline property"}},[s._v("RequestHeader")]),s._v(" set x-forwarded-proto "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https'")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Apache では static assets で 304 が返らないことがあるので ETag を無効化する")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive-block tag"}},[t("span",{pre:!0,attrs:{class:"token directive-block tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("ifModule")]),t("span",{pre:!0,attrs:{class:"token directive-block-parameter attr-value"}},[s._v(" mod_headers.c")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token directive-inline property"}},[s._v("Header")]),s._v(" unset ETag\n    "),t("span",{pre:!0,attrs:{class:"token directive-block tag"}},[t("span",{pre:!0,attrs:{class:"token directive-block tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("ifModule")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive-inline property"}},[s._v("FileETag")]),s._v(" None\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# socket.io の path を rewrite する")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive-inline property"}},[s._v("RewriteEngine")]),s._v(" On\n    "),t("span",{pre:!0,attrs:{class:"token directive-inline property"}},[s._v("RewriteCond")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("%{REQUEST_URI}")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token regex"}},[s._v("^/socket.io            ")]),t("span",{pre:!0,attrs:{class:"token directive-flags keyword"}},[s._v("[NC]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive-inline property"}},[s._v("RewriteCond")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("%{QUERY_STRING}")]),s._v(" transport=websocket    "),t("span",{pre:!0,attrs:{class:"token directive-flags keyword"}},[s._v("[NC]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive-inline property"}},[s._v("RewriteRule")]),s._v(" /(.*) ws://localhost:3000/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token directive-flags keyword"}},[s._v("[P,L]")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token directive-inline property"}},[s._v("ProxyPass")]),s._v(" / http://localhost:3000/\n    "),t("span",{pre:!0,attrs:{class:"token directive-inline property"}},[s._v("ProxyPassReverse")]),s._v(" / http://localhost:3000/\n    ...\n  "),t("span",{pre:!0,attrs:{class:"token directive-block tag"}},[t("span",{pre:!0,attrs:{class:"token directive-block tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("VirtualHost")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token directive-block tag"}},[t("span",{pre:!0,attrs:{class:"token directive-block tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("IfModule")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])])]),t("h4",{attrs:{id:"自動起動の設定"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自動起動の設定"}},[s._v("#")]),s._v(" 自動起動の設定")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--now")]),s._v(" apache2\n")])])]),t("h3",{attrs:{id:"nginx-のインストールと設定"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx-のインストールと設定"}},[s._v("#")]),s._v(" Nginx のインストールと設定")]),s._v(" "),t("h4",{attrs:{id:"インストール-5"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#インストール-5"}},[s._v("#")]),s._v(" インストール")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nginx\n")])])]),t("h4",{attrs:{id:"リバースプロキシの設定例-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#リバースプロキシの設定例-2"}},[s._v("#")]),s._v(" リバースプロキシの設定例")]),s._v(" "),t("p",[s._v("ここでは HTTPS を利用する設定例を記載しています。 "),t("code",[s._v("<server>")]),s._v(" など "),t("code",[s._v("<>")]),s._v(" で囲まれている箇所は、適宜環境に合わせて設定してください。")]),s._v(" "),t("div",{staticClass:"language-nginx extra-class"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" growi")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" localhost:3000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("map")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_upgrade")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$connection_upgrade")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" Upgrade")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    ''      "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("close")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl http")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" <server>")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_certificate")]),s._v(" <cert_file>")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_certificate_key")]),s._v(" <key_file>")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Forwarded-Proto "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$scheme")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Forwarded-Port "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$server_port")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Forwarded-For "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://growi")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_http_version")]),s._v(" 1.1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Upgrade "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_upgrade")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Connection "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$connection_upgrade")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_read_timeout")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("900s")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" <server>")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token directive"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" https://"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$server_name")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_uri")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("設定ファイルに問題がないことを確認します。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" nginx "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v("\nnginx: the configuration "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" /etc/nginx/nginx.conf syntax is ok\nnginx: configuration "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" /etc/nginx/nginx.conf "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" is successful\n")])])]),t("h4",{attrs:{id:"自動起動の設定-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自動起動の設定-2"}},[s._v("#")]),s._v(" 自動起動の設定")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--now")]),s._v(" nginx\n")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);