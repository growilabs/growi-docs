(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{515:function(a,e,t){"use strict";t.r(e);var r=t(69),s=Object(r.a)({},(function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"migrate-from-bakudankun-crowi"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#migrate-from-bakudankun-crowi"}},[a._v("#")]),a._v(" Migrate from bakudankun/crowi")]),a._v(" "),t("h2",{attrs:{id:"overview"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[a._v("#")]),a._v(" Overview")]),a._v(" "),t("ul",[t("li",[a._v("Assuming to migrate from [Crowi docker image + "),t("a",{attrs:{href:"https://github.com/crowi/docker-crowi",target:"_blank",rel:"noopener noreferrer"}},[a._v("bakudankun/crowi"),t("OutboundLink")],1),a._v("] to "),t("a",{attrs:{href:"https://github.com/growilabs/growi-docker-compose",target:"_blank",rel:"noopener noreferrer"}},[a._v("growilabs/growi-docker-compose"),t("OutboundLink")],1),a._v(".")]),a._v(" "),t("li",[a._v("Migrate the following data.\n"),t("ul",[t("li",[a._v("MongoDB container's data volume")]),a._v(" "),t("li",[a._v("Uploaded file data from the App container")])])])]),a._v(" "),t("h2",{attrs:{id:"preparation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#preparation"}},[a._v("#")]),a._v(" Preparation")]),a._v(" "),t("ol",[t("li",[a._v("Have Crowi and GROWI contaienr running.\n"),t("ul",[t("li",[t("p",[a._v("Hypothetically, each app container and data volume is called as below (change the name according to your environment).")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th"),a._v(" "),t("th",[a._v("Crowi")]),a._v(" "),t("th",[a._v("GROWI")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("App Container")]),a._v(" "),t("td",[a._v("crowi_crowi_1")]),a._v(" "),t("td",[a._v("growi_app_1")])]),a._v(" "),t("tr",[t("td",[a._v("App Container Data Volume")]),a._v(" "),t("td",[a._v("crowi_crowi_data")]),a._v(" "),t("td",[a._v("growi_growi_data")])]),a._v(" "),t("tr",[t("td",[a._v("MongoDB Container")]),a._v(" "),t("td",[a._v("crowi_mongo_1")]),a._v(" "),t("td",[a._v("growi_mongo_1")])])])])])])])]),a._v(" "),t("h2",{attrs:{id:"extract-password-seed"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#extract-password-seed"}},[a._v("#")]),a._v(" Extract PASSWORD_SEED")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("If PASSWORD_SEED was set in "),t("a",{attrs:{href:"https://github.com/crowi/docker-crowi",target:"_blank",rel:"noopener noreferrer"}},[a._v("bakudankun/crowi"),t("OutboundLink")],1),a._v(" environment variables, extract and reuse the seed in GROWI.")])]),a._v(" "),t("li",[t("p",[a._v("If not, extract and reuse the auto-generated seed in the data volume.")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("TBD"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])])])]),a._v(" "),t("h2",{attrs:{id:"migrate-db"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#migrate-db"}},[a._v("#")]),a._v(" Migrate DB")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("Backup DB data from Crowi with mongodump.")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--link")]),a._v(" crowi_mongo_1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--network")]),a._v(" crowi_default "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--volume")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("pwd")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(":/backup mongo "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v("\nmongodump "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--host")]),a._v(" crowi_mongo_1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--db")]),a._v(" crowi "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--out")]),a._v(" /backup\n")])])])]),a._v(" "),t("li",[t("p",[a._v("Restore the backup to GROWI.")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--link")]),a._v(" growi_mongo_1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--network")]),a._v(" growi_default  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--volume")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("pwd")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(":/backup mongo "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v("\nmongorestore "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--host")]),a._v(" growi_mongo_1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--db")]),a._v(" growi backup/crowi\n")])])]),t("p",[a._v("[TBC] Unique Constraint might fail.")])]),a._v(" "),t("li",[t("p",[a._v("Set "),t("code",[a._v("PASSWORD_SEED")])]),a._v(" "),t("ul",[t("li",[a._v("In "),t("code",[a._v("docker-compose.yml")]),a._v(", set "),t("code",[a._v("PASSWORD_SEED")]),a._v(" to the extracted "),t("code",[a._v("PASSWORD_SEED")]),a._v(".")])])]),a._v(" "),t("li",[t("p",[a._v("Restart GROWI.")])])]),a._v(" "),t("h2",{attrs:{id:"migrate-uploaded-file-data"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#migrate-uploaded-file-data"}},[a._v("#")]),a._v(" Migrate Uploaded File Data")]),a._v(" "),t("p",[t("strong",[a._v("If files are to be uploaded to AWS S3, skipped the following steps.")])]),a._v(" "),t("ul",[t("li",[a._v("By default, "),t("a",{attrs:{href:"https://github.com/crowi/docker-crowi",target:"_blank",rel:"noopener noreferrer"}},[a._v("bakudankun/crowi"),t("OutboundLink")],1),a._v(" saves uploaded files to local file system("),t("code",[a._v("FILE_UPLOAD=local")]),a._v(").")]),a._v(" "),t("li",[a._v("In order to save uploaded files to local file system set "),t("code",[a._v("FILE_UPLOAD=local")]),a._v(" (in "),t("code",[a._v("docker-compose.yml")]),a._v(").")])]),a._v(" "),t("ol",[t("li",[t("p",[a._v("Backup uploaded files from Crowi.")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" crowi_crowi_data:/data "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("pwd")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(":/backup bakudankun/crowi "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rp")]),a._v(" /data /backup\n")])])])]),a._v(" "),t("li",[t("p",[a._v("Restore the backup to GROWI.")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" crowiplus_crowi_data:/data "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("pwd")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(":/backup growi_app_1 "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rp")]),a._v(" /backup/uploads /data/\n")])])])])])])}),[],!1,null,null,null);e.default=s.exports}}]);