(window.webpackJsonp=window.webpackJsonp||[]).push([[210],{657:function(a,t,s){"use strict";s.r(t);var e=s(69),r=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"growi-v3-6-x-へのアップグレード"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#growi-v3-6-x-へのアップグレード"}},[a._v("#")]),a._v(" GROWI v3.6.x へのアップグレード")]),a._v(" "),s("p",[a._v("v3.6 では、Node.js v8 はサポートされなくなりました。")]),a._v(" "),s("p",[a._v("また v3.5 より下位のバージョンには、誤って2つのデータベースが作成されてしまうバグ("),s("a",{attrs:{href:"https://github.com/growilabs/growi/issues/1361",target:"_blank",rel:"noopener noreferrer"}},[a._v("growilabs/growi#1361"),s("OutboundLink")],1),a._v(")が存在します。")]),a._v(" "),s("h2",{attrs:{id:"node-js-v8-のサポートを終了"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#node-js-v8-のサポートを終了"}},[a._v("#")]),a._v(" Node.js v8 のサポートを終了")]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://hub.docker.com/r/growilabs/growi/",target:"_blank",rel:"noopener noreferrer"}},[a._v("公式の Docker イメージ"),s("OutboundLink")],1),a._v("を利用しているシステムには影響はありません")])]),a._v(" "),s("h3",{attrs:{id:"node-js-のアップグレード"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#node-js-のアップグレード"}},[a._v("#")]),a._v(" Node.js のアップグレード")]),a._v(" "),s("ol",[s("li",[a._v("v10 または v12 にアップグレードしてください")])]),a._v(" "),s("h2",{attrs:{id:"growilabs-growi-1361-の回避"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#growilabs-growi-1361-の回避"}},[a._v("#")]),a._v(" "),s("a",{attrs:{href:"https://github.com/growilabs/growi/issues/1361",target:"_blank",rel:"noopener noreferrer"}},[a._v("growilabs/growi#1361"),s("OutboundLink")],1),a._v(" の回避")]),a._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[a._v("WARNING")]),a._v(" "),s("p",[a._v("この問題は、"),s("code",[a._v("MONGO_URI")]),a._v(" が、"),s("code",[a._v("?key=value")]),a._v(" 形式のパラメータを含む URL で運用していた場合に限り影響があります")])]),a._v(" "),s("h3",{attrs:{id:"とにかくアップグレード"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#とにかくアップグレード"}},[a._v("#")]),a._v(" とにかくアップグレード")]),a._v(" "),s("ul",[s("li",[a._v("通常通りアップグレードしてください")]),a._v(" "),s("li",[a._v("影響\n"),s("ul",[s("li",[a._v("これまでの累積 migration が再度実行されます\n")]),a._v(" "),s("li",[a._v("設計上は問題ないはずですが、不整合があるデータが書き換わる可能性があります\n")])])])]),a._v(" "),s("h3",{attrs:{id:"安全なアップグレード"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安全なアップグレード"}},[a._v("#")]),a._v(" 安全なアップグレード")]),a._v(" "),s("ul",[s("li",[s("p",[s("code",[a._v("migrations")]),a._v(" コレクションを移植します。\n"),s("code",[a._v("mongodump")]),a._v(", "),s("code",[a._v("mongorestore")]),a._v(" を使える環境で以下を実行してください。\n"),s("code",[a._v("{dbname}")]),a._v(", "),s("code",[a._v("{dbname?key=value}")]),a._v(" は、実際の環境のDB名に置き換えてください。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mongodump "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("dbname?key"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" migrations "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" backup\n")])])]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mongorestore "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("dbname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" migrations "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"./backup/{dbname?key=value}/migrations.bson"')]),a._v("\n")])])])]),a._v(" "),s("li",[s("p",[a._v("不要な DB を drop します。mongo shell 内で以下を実行してください。\n"),s("code",[a._v("{dbname?key=value}")]),a._v(" は、実際の環境のDB名に置き換えてください。")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("use {dbname?key=value}\ndb.dropDatabase()\n")])])])])]),a._v(" "),s("h3",{attrs:{id:"アップグレード前にチェックすべきこと"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#アップグレード前にチェックすべきこと"}},[a._v("#")]),a._v(" アップグレード前にチェックすべきこと")]),a._v(" "),s("ul",{staticClass:"contains-task-list"},[s("li",{staticClass:"task-list-item"},[s("input",{staticClass:"task-list-item-checkbox",attrs:{checked:"",disabled:"",type:"checkbox"}}),a._v(" 運用中のシステムにセットしている "),s("code",[a._v("MONGO_URI")]),a._v(" が、"),s("code",[a._v("?key=value")]),a._v(" 形式のパラメータを含むか")]),a._v(" "),s("li",{staticClass:"task-list-item"},[s("input",{staticClass:"task-list-item-checkbox",attrs:{checked:"",disabled:"",type:"checkbox"}}),a._v(" 運用中のシステムが接続している MongoDB に、"),s("code",[a._v("?key=value")]),a._v(" 形式のパラメータを名前に含むデータベースが存在するか")])])])}),[],!1,null,null,null);t.default=r.exports}}]);