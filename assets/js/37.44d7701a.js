(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{485:function(a,e,t){"use strict";t.r(e);var s=t(69),r=Object(s.a)({},(function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"mongodb-backup-restore"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-backup-restore"}},[a._v("#")]),a._v(" MongoDB Backup & Restore")]),a._v(" "),t("p"),t("div",{staticClass:"table-of-contents"},[t("ul",[t("li",[t("a",{attrs:{href:"#overview"}},[a._v("Overview")])]),t("li",[t("a",{attrs:{href:"#using-aws-s3"}},[a._v("Using AWS S3")])]),t("li",[t("a",{attrs:{href:"#using-google-cloud-platform"}},[a._v("Using Google Cloud Platform")])])])]),t("p"),a._v(" "),t("h2",{attrs:{id:"overview"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[a._v("#")]),a._v(" Overview")]),a._v(" "),t("p",[a._v("This chapter introduces how to backup and restore GROWI data using "),t("a",{attrs:{href:"https://github.com/weseek/mongodb-awesome-backup",target:"_blank",rel:"noopener noreferrer"}},[a._v("weseek/mongodb-awesome-backup"),t("OutboundLink")],1),a._v(".")]),a._v(" "),t("h3",{attrs:{id:"requirements"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#requirements"}},[a._v("#")]),a._v(" Requirements")]),a._v(" "),t("ul",[t("li",[a._v("Docker")]),a._v(" "),t("li",[a._v("AWS S3 bucket to upload backup files\n"),t("ul",[t("li",[a._v("Access key and secret key for a user authorized to access S3 bucket.")])])])]),a._v(" "),t("h2",{attrs:{id:"using-aws-s3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#using-aws-s3"}},[a._v("#")]),a._v(" Using AWS S3")]),a._v(" "),t("h3",{attrs:{id:"before-you-start"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#before-you-start"}},[a._v("#")]),a._v(" Before You Start")]),a._v(" "),t("p",[a._v("To backup/restore MongoDBs, "),t("a",{attrs:{href:"https://github.com/weseek/mongodb-awesome-backup",target:"_blank",rel:"noopener noreferrer"}},[a._v("weseek/mongodb-awesome-backup"),t("OutboundLink")],1),a._v(" creates a temporary container that executes shell scripts. In order to access the MongoDB server from the temporary container, add the docker command option below.")]),a._v(" "),t("h4",{attrs:{id:"when-mongodb-is-running-as-a-docker-container"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#when-mongodb-is-running-as-a-docker-container"}},[a._v("#")]),a._v(" When MongoDB Is Running as a Docker Container")]),a._v(" "),t("p",[a._v("Run a command to find out the container name, and add an option "),t("code",[a._v("--link ${container}:mongo")]),a._v(" with the container name ("),t("code",[a._v("${container}")]),a._v(").\n")]),a._v(" "),t("h5",{attrs:{id:"e-g"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#e-g"}},[a._v("#")]),a._v(" e.g.")]),a._v(" "),t("p",[a._v("Use "),t("code",[a._v("docker ps")]),a._v(" to find out the container name.")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("vagrant@ubuntu-xenial:/etc/docker-compose$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v("\nCONTAINER ID        IMAGE                           COMMAND                  CREATED             STATUS                   PORTS               NAMES\n21a10f879cba        mongo                           "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"docker-entrypoint.sâ€¦"')]),a._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("11")]),a._v(" minutes ago      Up "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("11")]),a._v(" minutes            "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("27017")]),a._v("/tcp           serene_swartz\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("man")]),a._v("\n")])])]),t("p",[a._v("The command above shows the container name is "),t("code",[a._v("serene_swartzman")]),a._v(", therefore the option is "),t("code",[a._v("--link serene_swartz:mongo")]),a._v(".")]),a._v(" "),t("h4",{attrs:{id:"when-mongodb-is-not-running-as-a-docker-container"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#when-mongodb-is-not-running-as-a-docker-container"}},[a._v("#")]),a._v(" When MongoDB Is NOT Running as a Docker Container")]),a._v(" "),t("h5",{attrs:{id:"when-docker-host-is-linux"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#when-docker-host-is-linux"}},[a._v("#")]),a._v(" When Docker Host is Linux")]),a._v(" "),t("p",[a._v("Add "),t("code",[a._v("--network host")]),a._v(" to use the same network with the host.")]),a._v(" "),t("h5",{attrs:{id:"for-docker-for-mac"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#for-docker-for-mac"}},[a._v("#")]),a._v(" For Docker for Mac")]),a._v(" "),t("ul",[t("li",[a._v("(TBD: Looking for a contributor)")])]),a._v(" "),t("h5",{attrs:{id:"for-docker-for-windows"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#for-docker-for-windows"}},[a._v("#")]),a._v(" For Docker for Windows")]),a._v(" "),t("ul",[t("li",[a._v("(TBD: Looking for a contributor)")])]),a._v(" "),t("h3",{attrs:{id:"how-to-backup"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#how-to-backup"}},[a._v("#")]),a._v(" How to Backup")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("Run "),t("a",{attrs:{href:"https://github.com/weseek/mongodb-awesome-backup",target:"_blank",rel:"noopener noreferrer"}},[a._v("weseek/mongodb-awesome-backup"),t("OutboundLink")],1),a._v(" container with ("),t("code",[a._v("--rm")]),a._v(") flag.")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("MONGODB_HOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("Target MongoDB Host"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("AWS_ACCESS_KEY_ID")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("Your IAM Access Key ID"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("AWS_SECRET_ACCESS_KEY")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("Your IAM Secret Access Key"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("S3_TARGET_BUCKET_URL")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("Target S3 Bucket URL "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("s3://"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  weseek/mongodb-awesome-backup\n")])])])]),a._v(" "),t("li",[t("p",[a._v("The command creates a backup for all databases in the target MongoDB server, and upload it as "),t("code",[a._v("backup-YYYYMMdd.tar.bz2")]),a._v(" in the S3 bucket.")])])]),a._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),t("p",[a._v("See "),t("a",{attrs:{href:"https://github.com/weseek/mongodb-awesome-backup",target:"_blank",rel:"noopener noreferrer"}},[a._v("weseek/mongodb-awesome-backup"),t("OutboundLink")],1),a._v(" for more options.")])]),a._v(" "),t("h3",{attrs:{id:"how-to-restore"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#how-to-restore"}},[a._v("#")]),a._v(" How to Restore")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("Run "),t("a",{attrs:{href:"https://github.com/weseek/mongodb-awesome-backup",target:"_blank",rel:"noopener noreferrer"}},[a._v("weseek/mongodb-awesome-backup"),t("OutboundLink")],1),a._v(" container with ("),t("code",[a._v("--rm")]),a._v(") flag.")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("MONGODB_HOST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("Target MongoDB Host"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("AWS_ACCESS_KEY_ID")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("Your IAM Access Key ID"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("AWS_SECRET_ACCESS_KEY")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("Your IAM Secret Access Key"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("S3_TARGET_BUCKET_URL")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("Target S3 Bucket URL "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("s3://"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("S3_TARGET_FILE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("backup-YYYYMMdd.tar.bz2 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  weseek/mongodb-awesome-backup restore\n")])])])])]),a._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[a._v("The command restores the specified file ("),t("code",[a._v("backup-YYYYMMdd.tar.bz2")]),a._v(" in the example above ) in the S3 bucket.\n")]),a._v(" "),t("li",[a._v("Restart GROWI.")])]),a._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),t("p",[a._v("See "),t("a",{attrs:{href:"https://github.com/weseek/mongodb-awesome-backup",target:"_blank",rel:"noopener noreferrer"}},[a._v("weseek/mongodb-awesome-backup"),t("OutboundLink")],1),a._v(" for more options.")])]),a._v(" "),t("h2",{attrs:{id:"using-google-cloud-platform"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#using-google-cloud-platform"}},[a._v("#")]),a._v(" Using Google Cloud Platform")]),a._v(" "),t("ul",[t("li",[a._v("(TBD: Looking for a contributor)")])])])}),[],!1,null,null,null);e.default=r.exports}}]);